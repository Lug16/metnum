<!DOCTYPE html>
<html>

<head>
  <script type="text/javascript" src="./references/graph.js"></script>
  <script type="text/javascript" src="./references/math.min.js"></script>
  <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"
    async></script>
  <link href="https://fonts.googleapis.com/css?family=Montserrat" rel="stylesheet">
  <link rel="stylesheet" type="text/css" href="style.css">

  <script type="module">
    import {displaySolution} from './metnum.js';
    import solveNewtonRaphson from './methods/newton-raphson.mjs';

    const controls = {
      graphButton: document.getElementById('graphButton'),
      equationInput: document.getElementById('equationInput'),
      seedInput: document.getElementById("seedInput"),
      errorInput: document.getElementById('errorInput'),
      methodTitle: document.getElementById("methodTitle"),
      methodMessage: document.getElementById("methodMessage"),
      resultTable: document.getElementById("resultTable")
    }

    const { graphButton } = controls;
    graphButton.addEventListener("click", solve)

    const conf = {
      canvasId: 'myCanvas',
      minX: -5,
      minY: -5,
      maxX: 5,
      maxY: 5,
      unitsPerTick: 1
    }

    function solve(){
      const equation = math.parse(controls.equationInput.value);

      graphEquation(equation);
      solveEquation(equation);
    }

    function graphEquation(equation) {
      const myGraph = new Graph(conf);

      myGraph.drawEquation(function (x) {
        return equation.eval({ x });
      }, 'blue', 2);
    }

    function solveEquation(equation){
      const seed = Math.abs(controls.seedInput.value);
      const error = Math.pow(10, -Math.abs(controls.errorInput.value));

      const solution = solveNewtonRaphson(equation, seed, error);

      displaySolution(solution, controls);
    }
  </script>
</head>

<body>
  <div style="text-align:center">
    <input id="equationInput" type="text" value="x^3-x-1" placeholder="Inserte ecuaci&#243;n (ejem: x^3-x-1)" />
    <input id="seedInput" type="number" value="1" placeholder="Punto Inicial (ejem: 1)" />
    <input id="errorInput" type="number" value="3" placeholder="Error (ejem: 3)" />
    <button id="graphButton">Graficar</button>
  </div>
  <div id="container">
    <canvas id="myCanvas" width="500" height="500"></canvas>
    <div>
      <h2 id="methodTitle"></h2>
      <p id="methodMessage"></p>
      <table id="resultTable"></table>
    </div>
  </div>
</body>

</html>