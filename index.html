<!DOCTYPE html>
<html>

<head>
  <script type="text/javascript" src="./references/graph.js"></script>
  <script type="text/javascript" src="./references/math.min.js"></script>
  <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"
    async></script>
  <link href="https://fonts.googleapis.com/css?family=Montserrat" rel="stylesheet">
  <link rel="stylesheet" type="text/css" href="style.css">
</head>

<body>
  <div style="text-align:center">
    <select id="methodsSelect">
      <option>Seleccione...</option>
    </select>
    <input id="equationInput" type="text" value="x^3-x-1" placeholder="Inserte ecuaci&#243;n (ejem: x^3-x-1)" />
    <div id="dynamicContainer"></div>
    <button id="graphButton">Graficar</button>
  </div>
  <div id="container">
    <canvas id="myCanvas" width="500" height="500"></canvas>
    <div>
      <h2 id="methodTitle"></h2>
      <p id="methodMessage"></p>
      <table id="resultTable"></table>
    </div>
  </div>
</body>
<script type="module">
  import { displaySolution } from './metnum.js';
  import { methodsList } from './references/common.mjs';

  const controls = {
    graphButton: document.getElementById('graphButton'),
    equationInput: document.getElementById('equationInput'),
    methodMessage: document.getElementById("methodMessage"),
    methodsSelect: document.getElementById("methodsSelect"),
    methodTitle: document.getElementById("methodTitle"),
    resultTable: document.getElementById("resultTable")
  }

  const { graphButton, methodsSelect } = controls;
  graphButton.addEventListener("click", solve);
  methodsSelect.addEventListener("change", methodSelected);
  document.addEventListener("DOMContentLoaded", load);

  const conf = {
    canvasId: 'myCanvas',
    minX: -5,
    minY: -5,
    maxX: 5,
    maxY: 5,
    unitsPerTick: 1
  }

  let selectedMethod = null;

  function load() {
    const { methodsSelect } = controls;

    methodsList.map(r => {
      const method = document.createElement("option");
      const text = document.createTextNode(r.name);
      method.appendChild(text);

      methodsSelect.appendChild(method);
    });
  }

  function methodSelected(e) {
    selectedMethod = methodsList.filter(r => r.name === this.options[this.selectedIndex].value)[0];
  }

  function solve() {
    const equation = math.parse(controls.equationInput.value);

    graphEquation(equation);
    solveEquation(equation);
  }

  function graphEquation(equation) {
    const myGraph = new Graph(conf);

    myGraph.drawEquation(function (x) {
      return equation.eval({ x });
    }, 'blue', 2);
  }

  function solveEquation(equation) {
    const error = Math.pow(10, -3);

    const solution = selectedMethod.solve(equation, 1, error);

    displaySolution(solution, controls);
  }
</script>

</html>